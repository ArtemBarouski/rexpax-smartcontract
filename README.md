# Ручной анализ кода контракта

| Номер строки | Код                                                                          | Описание                                                                                                                                                                                                                                                                                                  | Приоритет |
|--------------|------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------|
| 1            | pragma solidity ^0.4.18;                                                     | Необходимо строго зафиксировать версию языка                                                                                                                                                                                                                                                              | **Исправлено**   |
| 4            | contract owned {                                                             | Лучше использовать протестированную версию Claimable контракта от OpenZeppelin  https://github.com/OpenZeppelin/zeppelin-solidity/blob/master/contracts/ownership/Claimable.sol                                                                                                                           | Низкий, **Нет необходимости, функционал идентичный**    |
| 9            | function owned() payable internal                                            | Нет необходимости делать конструктор payable, если не предполагается передача средств на адрес контракта при деплойменте.                                                                                                                                                                                 | **Исправлено**   |
| 34           | library SafeMath {                                                           | Лучше использовать протестированную версию SafeMath контракта от OpenZeppelin (или ранее загруженную в есть версию библиотеки для экономии стоимости деплоймента)  https://github.com/OpenZeppelin/zeppelin-solidity/blob/master/contracts/math/SafeMath.sol                                              | **Исправлено**   |
| 48           | contract ERC20 {                                                             | Лучше использовать протестированную версию ERC20 интерфейса от OpenZeppelin                                                                                                                                                                                                                               | Низкий, **Нет необходимости, функционал идентичный**    |
| 61           | contract AdvancedToken is ERC20, owned {                                     | Лучше использовать протестированные версии BurnableToken и MintableToken  https://github.com/OpenZeppelin/zeppelin-solidity/blob/master/contracts/token/MintableToken.sol https://github.com/OpenZeppelin/zeppelin-solidity/blob/master/contracts/token/BurnableToken.sol                                 | Низкий, **Нет необходимости, функционал идентичный**    |
| 87           | function withdrawTokens(uint256 _value) public onlyOwner {                   | Проблема потери токенов должна быть решена глобально реализацией ERC233 токена, который полностью совместим с ERC20 реализацией  https://github.com/Dexaran/ERC223-token-standard                                                                                                                         | Средний, **Виталик бутерин не одобряет, пруф https://goo.gl/HYTPHc**   |
| 95           | function withdrawEther(uint256 _value) public onlyOwner {                    | Токен должен отклонять прямую отправку эфира на свой адрес. Может быть реализовано при помощи HasNoEther контракта из OpenZeppelin  https://github.com/OpenZeppelin/zeppelin-solidity/blob/master/contracts/ownership/HasNoEther.sol                                                                      | Средний, **Очень сильно зависит от реализации контракта, это субъективное мнение и отсылка к Multisig? Есть ли более весомые рекомендации зачем это нужно делать?**   |
| 101          | contract ICO is AdvancedToken {                                              | Контракт краудсейла не должен наследоваться от токена. Токен и краудсейл должны иметь разные адреса, а токен передаваться в краудсейл в конструкторе.Пример реализации в OpenZeppelin  https://github.com/OpenZeppelin/zeppelin-solidity/blob/master/contracts/crowdsale/Crowdsale.sol#L49                | Средний, **Текущая реализация - рабочая, это субъективное мнение и отсылка к Multisig? Есть ли более весомые рекомендации зачем это нужно делать?**   |
| 126          | function ICO() internal payable owned                                        | Нет необходимости делать конструктор payable, если не предполагается передача средств на адрес контракта при деплойменте. Нет необходимости добавлять модификатор owned для конструктора                                                                                                                  | **Исправлено**    |
| 127          | require(contract_state == State.Disabled);                                   | Нет необходимости проверить начальное состояние краудсейла, так как оно задается выше в переменную по умолчанию                                                                                                                                                                                           | **Исправлено**    |
| 128          | totalSupply = 0;                                                             | Переменная изначально равна нулю. Нет необходимости приравнивать ее к нулю.                                                                                                                                                                                                                               | **Исправлено**    |
| 130          | startTime = 1512482400;                                                      | Должно быть заменено при деплойменте в публичную сеть                                                                                                                                                                                                                                                     | **Исправлено, не та версия**  |
| 131          | presaleMaxSupply = 190000000;                                                | Если в токене предполагается 18 знаков после запятой, значит и все значения количества токенов должны быть умножены на 10 ^ 18. Например, для 190000000 число с 18 знаками будет равно 1.9e26                                                                                                             | **Исправлено, не та версия**   |
| 132          | marketMaxSupply = 1260000000;                                                | Если токене предполагается 18 знаков после запятой, значит и все значения количества токенов должны быть умножены на 10 ^ 18.                                                                                                                                                                             | **Исправлено, не та версия**   |
| 138          | function () private payable crowdsaleState {                                 | Такая сигнатура функции может сбивать с толку. Рекомендуется: function () private payable                                                                                                                                                                                                                 | Низкий, **Тогда токены можно будет покупать в любое время, даже после ICO, исправление не требуется**    |
| 142, 143     | uint256 tokensPerEther = 46500;uint256 _tokens = tokensPerEther * msg.value; | Неявная работа с 18 знаками после запятой для количества токенов. Подобная логика должна быть вынесена в единый метод для подсчета стоимости одного токена. Пример:  https://github.com/TokenMarketNet/ico/blob/master/contracts/FlatPricing.sol                                                          | Средний, **Неявная работа - это когда состояние заранее не известно и непонятно где оно меняется, нет необходимости в дополнительном методе, функционал прозрачен**   |
| 217          | contract Rexpax is ICO {                                                     | Контракт краудсейла не должен наследоваться от токена. Токен и краудсейл должны иметь разные адреса, а токен передаваться в краудсейл в конструкторе.Пример реализации в OpenZeppelin  https://github.com/OpenZeppelin/zeppelin-solidity/blob/master/contracts/crowdsale/Crowdsale.sol#L49                | Средний, **Дубликат 101**   |
| -            | -                                                                            | Средства, переданные на ICO должны передаваться на отдельный адрес контракта (Multisig Wallet) либо на отдельный эфириум адрес. Необходимо избегать хранения токенов и эфира служебными контрактами, которые для этого не предназначены.  Gnosis Multisig Wallet   https://github.com/gnosis/MultiSigWallet | Высокий, **Реализован метод для вывода эфира с контракта только владельцем, нет необходимости в данном функционале. Вообще плохая практика выводить куда-то деньги если ICO не закончено, дабы иметь возможность потом эти средства возместить, я не сторонник Multisig кошельков (контрактов), два случая с Parity показательные.**   |
